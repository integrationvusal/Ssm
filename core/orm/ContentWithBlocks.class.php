<?php	class ContentWithBlocks extends CRUDModel {		public static function add($request, &$smarty, $vars = Array(), $saveItem = true, $model = false) {			$data = parent::add($request, $smarty, $vars, $saveItem);						$data['data']['allBlocks'] = ContentModel::getAllBlocks();						$data['tpl'] = 'model' . ds . 'dynamic-page-action.tpl';						if (isset($_POST['saveItem']) && $saveItem) {				if ($data['result']['success']) {					foreach ($data['result']['data'] as $o) ContentModel::saveContent($o, $vars['model_id']);				}			}						return $data;		}				public static function edit($request, &$smarty, $vars = Array(), $saveItem = true, $model = false) {			$data = parent::edit($request, $smarty, $vars);						if (isset($_POST['saveItem'])) {				if ($data['result']['success']) {					foreach ($data['result']['data'] as $o) ContentModel::saveContent($o, $vars['model_id']);				}			}						$modelId = $vars["model_id"];			$modelItemId = $vars["model_item_id"];						$id = self::$multiLang ? "r_id" : "id";						$existsBlocks = "";			$objects = self::find(" WHERE `".$id."` = '".$modelItemId."'");			foreach ($objects as $o) {				$lang = (self::$multiLang) ? $o->lang_id->value : false;				$existsBlocks .= ContentModel::getExistsBlocks($modelId, $o->id->value, $lang);			}						$data['data']['allBlocks'] = ContentModel::getAllBlocks();						$data['data']['existsBlocks'] = $existsBlocks;						$data['tpl'] = 'model' . ds . 'dynamic-page-action.tpl';						return $data;		}				public static function getForm(&$smarty, $data = false, $lang = false) {			return parent::getForm($smarty, $data, $lang);		}				public static function deleteItem($request, &$smarty, $vars = Array(), $itemsToDelete = Array()) {			$deleteId = isset($_POST['delete_id']) ? $_POST['delete_id'] : $itemsToDelete;			$modelId = $vars['model_id'];						$model = Application::$modules[Application::$adminName]['models'][$modelId];			$model::initialize();						$id = (self::$multiLang) ? 'r_id' : 'id';			foreach ($deleteId as $dId) {				$d1 = self::find(" WHERE `". $id ."` = '{#1}'", Array($dId));				print_r($d1);				foreach ($d1 as $d2) {					print_r($d2);					$content = ContentModel::find(" WHERE `classId` = '{#1}' AND `classRecordId` = '{#2}'", Array($modelId, $d2->id->value));					foreach ($content as $c) {						print_r($c);						$blockModel = BlockModel::find(" WHERE `contentModelId` = '{#1}'", Array($c->id->value));						foreach ($blockModel as $b) {							print_r($b);							$blockField = BlockFieldModel::find(" WHERE `blockId` = '{#1}'", Array($b->id->value));							foreach ($blockField as $bf) {								print_r($bf);								$bf->remove();							}							$b->remove();						}						$c->remove(" WHERE ``");					}				}			}						parent::deleteItem($request, $smarty, $vars, $itemsToDelete);		}	}?>